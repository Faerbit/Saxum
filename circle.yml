general:
    branches:
        only:
            - master

machine:
    services:
        - docker

dependencies:
    override:
        # Set up dropbox_uploader
        - curl "https://raw.githubusercontent.com/andreafabrizi/Dropbox-Uploader/master/dropbox_uploader.sh" -o dropbox_uploader.sh
        - chmod +x dropbox_uploader.sh
        - echo $db_uploader > ~/.dropbox_uploader

database:
    override:

test:
    override:
        - docker run -v ~/swp:/swp/swp -w=/swp/swp -u=$(id -u) faerbit/swp ./package.sh linux
        - docker run -v ~/swp:/swp/swp -w=/swp/swp -u=$(id -u) faerbit/swp ./package.sh windows
        - if [ -f MarbleGame_Windows.zip ]; then cp MarbleGame_Windows.zip $CIRCLE_ARTIFACTS; fi
        - if [ -f MarbleGame_Linux.zip ]; then cp MarbleGame_Linux.zip $CIRCLE_ARTIFACTS; fi

deployment:
    master:
        branch: master
        commands:
            - if [ -f MarbleGame_Windows.zip ]; then ./dropbox_uploader.sh -p upload MarbleGame_Windows.zip /; fi
            - if [ -f MarbleGame_Linux.zip ]; then ./dropbox_uploader.sh -p upload MarbleGame_Linux.zip /; fi
