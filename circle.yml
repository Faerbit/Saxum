general:
    branches:
        only:
            - master
dependencies:
    override:
        - sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
        - sudo add-apt-repository ppa:kalakris/cmake -y
        - sudo apt-get -qq update
        - sudo apt-get -qq install cmake
        - sudo apt-get install -qq g++-4.8
        - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.8 90
        - sudo apt-get install -qq xorg-dev
        - sudo apt-get install ninja-build
        # Install megacmd
        - git clone https://github.com/t3rm1n4l/megacmd.git
        - cd megacmd; make
        - sudo cp megacmd/megacmd /usr/local/bin
        - echo $megacmd > ~/.megacmd.json
        # Install mingw-w64
        - git clone https://github.com/mxe/mxe.git
        - cd mxe; make MXE_TARGETS="x86_64-w64-mingw32" -j$(($(nproc)+1))

database:
    override:

test:
    override:
        - ./package.sh windows
        - ./package.sh linux
        - cp  MarbleGame_Windows.zip MarbleGame_Linux.zip $CIRCLE_ARTIFACTS

deployment:
    master:
        branch: master
        commands:
            - megacmd -force put MarbleGame_Windows.zip mega:/GameBuilds/
            - megacmd -force put MarbleGame_Linux.zip mega:/GameBuilds/
