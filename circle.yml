general:
    branches:
        only:
            - master

machine:
    services:
        - docker

dependencies:
    override:
        # Install megacmd
        - git clone https://github.com/t3rm1n4l/megacmd.git
        - cd megacmd; make
        - sudo cp megacmd/megacmd /usr/local/bin
        - echo $megacmd > ~/.megacmd.json

database:
    override:

test:
    override:
        - docker run ~/swp:/swp -w=/swp -u=$(id -u) faerbit/swp ./package.sh linux
        - docker run ~/swp:/swp -w=/swp -u=$(id -u) faerbit/swp ./package.sh windows
        - cp MarbleGame_Linux.zip $CIRCLE_ARTIFACTS
        - if [ $(ls MarbleGame_Windows.zip 2> /dev/null) ]; then cp MarbleGame_Windows.zip $CIRCLE_ARTIFACTS; fi

deployment:
    master:
        branch: master
        commands:
            - if [ $(ls MarbleGame_Windows.zip) ];then megacmd -force put MarbleGame_Windows.zip mega:/GameBuilds/; fi
            - megacmd -force put MarbleGame_Linux.zip mega:/GameBuilds/
